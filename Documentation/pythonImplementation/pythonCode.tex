\chapter{Implementierungen in Python}
\label{chp:python:implementation}

\section{Warum Python?}
Python ist eine Skriptsprache, die auch im wissenschaftlichen Umfeld und für maschinelles Lernen verwendet wird\footnote{Siehe: \cite{Fuxjaeger2017}.}.
Dadurch existieren im Umfeld der Programmiersprache viele Bibliotheken die eingebunden und verwendet werden können.
Aufgrund der großen Nutzerbasis und Dokumentation der verwendeten Bibliotheken sind notwendige Informationen leichter zu recherchieren.
Ein weiterer Vorteil von Python kommt daher, dass es sich um eine Skriptsprache handelt, die interpretiert wird.
Anpassungen können schnell umgesetzt und getestet werden, ohne die komplette Anwendung neu zu kompilieren und zu veröffentlichen.

\section{Verwendete Bibliotheken}
Zwei externe Bibliotheken werden für das Projekt benötigt:
\begin{description}[style=nextline]
	\item[NumPy] Eine Bibliothek für mathematische Operationen auf multi-dimensionalen Arrays\footnote{Siehe: \cite{Athanasias2014}.}. Aus dieser Bibliothek werden mathematische Funktionen verwendet.
	\item[Matplotlib] Diese Bibliothek bietet Plotting-Funktionalitäten zur Darstellung von Graphiken\footnote{Siehe: \cite{Matplotlib2019}.}. Sie wird verwendet um PDF-Dateien aus der Analyse zu generieren.
\end{description}
\section{Installationsanleitung}
Damit die Skripte lauffähig sind, müssen sowohl Python als auch die zusätzlichen Bibliotheken installiert werden.
Benötigt wird Python 3 (in der Entwicklung wurde Version 3.7.0 verwendet).
Die zusätzlichen Bibliotheken können über \enquote{pip}\footnote{Siehe: \cite{Foundation2019}.}, das Paketverwaltungsprogramm für Python, installiert werden. 
Folgende Befehle können zur Installation der Paketen verwendet werden.

\subsection{Paketinstallation unter Windows}
Unter Windows können die Pakete über das folgende Kommando installiert werden (vorausgesetzt, Python 3 ist installiert. Pip sollte bei der Installation von Python bereits installiert werden):
\lstnewenvironment{PipCommandWindows}
{\lstset{
		captionpos=b,
		frame=single,
		label={lst:pipwindows},
		caption={Kommando zur Installation der notwendigen Pakete unter Windows},
		showspaces=false,
		showtabs=false,
		breaklines=true,
		showstringspaces=false,
		breakatwhitespace=true,
		escapeinside={(*@}{@*)},
		commentstyle=\color{greencomments},
		morecomment = [l]{\#\ },
		morekeywords={ },
		keywordstyle=\color{blue},
		stringstyle=\color{black},
		morestring=[b]",
		basicstyle=\ttfamily\footnotesize,
		numberbychapter=false}}{}

\begin{PipCommandWindows}
pip install numpy matplotlib
\end{PipCommandWindows}

\subsection{Paketinstallation unter Linux}
Unter Linux kann es notwendig werden, die Pakete explizit für Python 3 zu installieren. Im Folgenden sind die dafür notwendigen Kommandos abgebildet.
\lstnewenvironment{PipCommandLinux}
{\lstset{
		captionpos=b,
		frame=single,
		label={lst:piplinux},
		caption={Kommando zur Installation der notwendigen Pakete unter Linux},
		showspaces=false,
		showtabs=false,
		breaklines=true,
		showstringspaces=false,
		breakatwhitespace=true,
		escapeinside={(*@}{@*)},
		commentstyle=\color{greencomments},
		morecomment = [l]{\#\ },
		morekeywords={ },
		keywordstyle=\color{blue},
		stringstyle=\color{black},
		morestring=[b]",
		basicstyle=\ttfamily\footnotesize,
		numberbychapter=false}}{}

\begin{PipCommandLinux}
pip install numpy matplotlib
\end{PipCommandLinux}
Hinweis: Je nach Konfiguration des Systems kann auch folgendes Kommando notwendig sein, um die Pakete explizit unter Python 3 zu installieren: 

\lstnewenvironment{Pip3CommandLinux}
{\lstset{
		captionpos=b,
		frame=single,
		label={lst:pip3linux},
		caption={Kommando zur Installation der notwendigen Pakete unter Linux (Verwendung von pip3)},
		showspaces=false,
		showtabs=false,
		breaklines=true,
		showstringspaces=false,
		breakatwhitespace=true,
		escapeinside={(*@}{@*)},
		commentstyle=\color{greencomments},
		morecomment = [l]{\#\ },
		morekeywords={ },
		keywordstyle=\color{blue},
		stringstyle=\color{black},
		morestring=[b]",
		basicstyle=\ttfamily\footnotesize,
		numberbychapter=false}}{}

\begin{Pip3CommandLinux}
pip3 install numpy matplotlib
\end{Pip3CommandLinux}

\section{Verwendung von Docker}
Es besteht die Möglichkeit, die Skripte auch mit Hilfe von Docker-Container auszuführen.
Die Verwendung von Docker hat Vor- und Nachteile, die allerdings nicht Bestandteil dieser Arbeit sind.
Durch die Verwendung von Docker ist die lokale Installation von Python und den benötigten Bibliotheken nicht mehr notwendig.
Allerdings ist dafür eine lauffähige Installation von Docker notwendig.

Für die Verwendung von Docker existieren Beispiele im Anhang unter Kapitel~\ref{docker:examples}.

\textcolor{red}{Quelle hinzufügen}

\input{./pythonImplementation/project.tex}
\input{./pythonImplementation/categorization.tex}
\input{./pythonImplementation/crosscorr_introduction.tex}
\input{./pythonImplementation/crosscorrelation.tex}


\chapter{Ausführung der automatisierten Skripte}
Die einzelnen Module sind durch Skripte automatisierbar.
Ein Skript welches alle Module ausführt und als Einstiegspunkt dient, ist in der \enquote{automated\_script.py}-Datei abgelegt und kann direkt verwendet werden.
Voraussetzung für die Ausführung sind die Pakete aus Kapitel~\ref{chp:python:implementation}, deren Installation im entsprechendem Kapitel beschrieben sind.

Automatisierung bedeutet in diesem Kontext, dass Quelldateien automatisch eingelesen und verarbeitet werden.
Die Ergebnisse werden in Form von PDF-Dateien im Quellverzeichnis mit abgelegt.

\section{Anleitung zur Ausführung der Skripte}
Das automatisierte Skript kann über die Kommandozeile ausgeführt werden.
Optional ist es möglich einen Pfad zu einem Ordner anzugeben, in dem die Quelldateien abgelegt sind.
Wenn kein Pfad angegeben wird, wird ein Ordner mit dem Namen \enquote{sourceFiles} verwendet, der sich im gleichen Verzeichnis wie das Skript befinden muss.
Sollte dieser Ordner nicht existieren, legt das Skript diesen automatisch an.
Die Quelldateien können dann in diesem Ordner abgelegt werden und werden bei der nächsten Ausführung des Skripts verarbeitet.
Alternativ dazu kann Docker verwendet werden, siehe dazu auch im Anhang unter Kapitel~\ref{docker:examples}.

\subsection{Kommando zur Ausführung}
Nachdem man mit einer Konsole in das Verzeichnis gewechselt ist indem der Code angelegt ist, lässt sich das Skript über folgendes Kommando ausführen:

\lstnewenvironment{ExecuteCommandWindows}
{\lstset{
		captionpos=b,
		frame=single,
		label={lst:pip3linux},
		caption={Kommando zur Ausführung des Skripts unter Windows},
		showspaces=false,
		showtabs=false,
		breaklines=true,
		showstringspaces=false,
		breakatwhitespace=true,
		escapeinside={(*@}{@*)},
		commentstyle=\color{greencomments},
		morecomment = [l]{\#\ },
		morekeywords={ },
		keywordstyle=\color{blue},
		stringstyle=\color{black},
		morestring=[b]",
		basicstyle=\ttfamily\footnotesize,
		numberbychapter=false}}{}

\begin{ExecuteCommandWindows}
Windows Kommandozeile:
	python automated_script.py
Windows Powershell:
	python .\automated\_script.py
Mit optionalem Parameter:
	python automated_script.py C:\Temp\sourcefolder
\end{ExecuteCommandWindows}

Unter Linux analog dazu:

\lstnewenvironment{ExecuteCommandLinux}
{\lstset{
		captionpos=b,
		frame=single,
		label={lst:pip3linux},
		caption={Kommando zur Ausführung des Skripts unter Linux},
		showspaces=false,
		showtabs=false,
		breaklines=true,
		showstringspaces=false,
		breakatwhitespace=true,
		escapeinside={(*@}{@*)},
		commentstyle=\color{greencomments},
		morecomment = [l]{\#\ },
		morekeywords={ },
		keywordstyle=\color{blue},
		stringstyle=\color{black},
		morestring=[b]",
		basicstyle=\ttfamily\footnotesize,
		numberbychapter=false}}{}

\begin{ExecuteCommandLinux}
Je nach Konfiguration des Systems:
	python automated_script.py
Oder:
	python3 automated_script.py
\end{ExecuteCommandLinux}

Anschließend wird das Skript ausgeführt und die Log-Meldungen werden auf der Konsole ausgegeben.
Ein Beispiel für die ausgegebenen Log-Meldungen ist im Anhang unter Listing~\ref{lst:pythonlogs} zu sehen.

\pagebreak
\section{Ablauf der automatisierten Ausführung}
Die folgende Aktionen werden durch das bereitgestellte Skript ausgeführt. 
Der Übersicht wegen, werden einige Aktionen zusammengefasst und nicht im Detail dargestellt.

\begin{enumerate}[nolistsep]
	\item Auswahl des Quellverzeichnis (über optionalen Parameter oder Standardverzeichnis).
	\item Einlesen der CSV-Dateien aus dem ausgewählten Quellverzeichnis.
	\item Verarbeitung der einzelnen Quelldateien
	\begin{enumerate}[nolistsep]
		\item Anlegen eines Analysation-Requests
		\item Analyse und Verarbeitung der einzelnen Zeilen zur Unterscheidung zwischen Rohdaten und Metadaten
		\item Expansion der Rohdaten (Dekomprimierung)
	\end{enumerate}
	\item Kategorisierung der einzelnen Sequenzen
	\begin{enumerate}[nolistsep]
		\item Analyse der Frequenz
		\begin{enumerate}[nolistsep]
			\item Berechnung der Frequenz für die Quellsequenz
			\item Bildung der Subsequenzen inklusive Berechnung der jeweiligen Frequenzen
		\end{enumerate}
		\item Analyse der Balance
			\begin{enumerate}[nolistsep]
			\item Berechnung der Balance für die Quellsequenz
			\item Bildung der Subsequenzen inklusive Berechnung der jeweiligen Balance
		\end{enumerate}
		\item Generierung der PDF-Dateien zur Darstellung der Ergebnisse der Kategorisierung
	\end{enumerate}
	\item Berechnung der Kreuzkorrelation zwischen Sequenzen einer Quelldatei
	\begin{enumerate}[nolistsep]
		\item Vergleich der Quellsequenzen hinsichtlich der Möglichkeit die Kreuz-Korrelation zu berechnen
		\item Berechnung der Kreuzkorrelation bei geeigneten Sequenz-Paaren
		\item Generierung der PDF-Dateien zur Darstellung der Ergebnisse
	\end{enumerate}
\end{enumerate}

\textcolor{red}{Ergebnisdarstellung Anhang}

\section{Verbesserungsmöglichkeiten und Erweiterungen}
Da Matplotlib nicht threadsafe ist\footnote{Siehe: \cite{Stackoverflow2016}.}, kann die Generierung von PDF-Dateien nicht ohne Weiteres parallelisiert werden.
Bei einer parallelen Generierung würde Matplotlib gleichzeitig aus verschiedenen Programmbereichen aus aufgerufen werden.
Bei Programmen die nicht threadsafe sind, kann dies zu Fehlern führen.
Wenn ein Programm threadsafe ist, sind solche parallelen Aufrufe ohne Behinderungen oder Fehler möglich.

Da ein Großteil der Ausführungszeit für die Generierung der PDFs benötigt wird, wäre allerdings eine Parallelisierung in diesem Bereich von Vorteil.
Eine mögliche Erweiterung um die Leistung durch Parallelisierung zu steigern, wäre die Einführung eines Multi-Prozess-Ansatzes zur Generierung der PDF-Dateien.
Dabei würde für jede zu generierende Datei ein eigener Prozess gestartet werden, dessen Speicherbereich von den anderen Generierungsprozessen getrennt ist.
Da ein Prozess schwergewichtiger als ein einfacher Thread ist, hat diese Lösung natürlich auch seine eigenen Nachteile.
Ein weiterer Nachteil wäre die notwendige Verwaltung der Prozesse sowie die Kommunikation zwischen den Prozessen.
Eine solche Lösung ist nur mit zusätzlichem Entwicklungsaufwand umsetzbar.